{"version":3,"sources":["../src/pool.js"],"names":["map","envVar","process","env","pool","size","Number","SLACK_POOL_SIZE","path","require","resolve","server","scopes","SLACK_SCOPE","split","slackClient","clientID","SLACK_CLIENTID","clientSecret","SLACK_CLIENTSECRET","storage","MONGO","listen","port","PORT","close","stop","exit","on"],"mappings":";;AAAA;;;;AACA;;AACA;;;;;;;;AAEA,oFAAoFA,GAApF,CAAwFC,UACtF,sBAAOC,QAAQC,GAAR,CAAYF,MAAZ,CAAP,EAA6B,6BAA4BA,MAAO,EAAhE,CADF;;AAIA,kBAAC,aAAY;AACX,QAAMG,OAAO,gBAAS;AACpBC,UAAMC,OAAOJ,QAAQC,GAAR,CAAYI,eAAnB,CADc;AAEpBC,UAAMC,QAAQC,OAAR,CAAgB,OAAhB;AAFc,GAAT,CAAb;;AAKA,QAAMC,SAAS,kBAAW;AACxBP,QADwB;AAExBQ,YAAQV,QAAQC,GAAR,CAAYU,WAAZ,CAAwBC,KAAxB,CAA8B,GAA9B,CAFgB;AAGxBC,iBAAa;AACXC,gBAAUd,QAAQC,GAAR,CAAYc,cADX;AAEXC,oBAAchB,QAAQC,GAAR,CAAYgB;AAFf,KAHW;AAOxBC,aAAS,MAAM,qBAAalB,QAAQC,GAAR,CAAYkB,KAAzB;AAPS,GAAX,CAAf;;AAUAV,SAAOW,MAAP,CAAc,EAAEC,MAAMjB,OAAOJ,QAAQC,GAAR,CAAYqB,IAAnB,KAA4B,IAApC,EAAd;;AAEA,QAAMC;AAAA,kCAAQ,aAAY;AACxB,YAAMd,OAAOe,IAAP,EAAN;AACAxB,cAAQyB,IAAR,CAAa,CAAb;AACD,KAHK;;AAAA;AAAA;AAAA;AAAA,MAAN;AAIAzB,UAAQ0B,EAAR,CAAW,QAAX,EAAqBH,KAArB;AACAvB,UAAQ0B,EAAR,CAAW,SAAX,EAAsBH,KAAtB;AACD,CAxBD","file":"pool.js","sourcesContent":["import assert from 'assert';\nimport { Pool, Server } from 'koack';\nimport mongoStorage from 'koack/storages/mongo';\n\n['SLACK_CLIENTID', 'SLACK_CLIENTSECRET', 'SLACK_POOL_SIZE', 'SLACK_SCOPE', 'MONGO'].map(envVar =>\n  assert(process.env[envVar], `Missing env configuration ${envVar}`)\n);\n\n(async () => {\n  const pool = new Pool({\n    size: Number(process.env.SLACK_POOL_SIZE),\n    path: require.resolve('./bot'),\n  });\n\n  const server = new Server({\n    pool,\n    scopes: process.env.SLACK_SCOPE.split(','),\n    slackClient: {\n      clientID: process.env.SLACK_CLIENTID,\n      clientSecret: process.env.SLACK_CLIENTSECRET,\n    },\n    storage: await mongoStorage(process.env.MONGO),\n  });\n\n  server.listen({ port: Number(process.env.PORT) || 3000 });\n\n  const close = async () => {\n    await server.stop();\n    process.exit(0);\n  };\n  process.on('SIGINT', close);\n  process.on('SIGTERM', close);\n})();\n"]}